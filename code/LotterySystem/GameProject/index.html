<!DOCTYPE html>
<html>
<head>
    <title>SignalR Simple Chat</title>
    <style type="text/css">
        .container {
            background-color: #99CCFF;
            border: thick solid #808080;
            padding: 20px;
            margin: 20px;
        }
    </style>  
</head>
<body onload="init();">
    <div class="container">
        <input type="text" id="message" />
        <input type="button" id="sendmessage" value="Send" />
        <input type="hidden" id="displayname" />
        <ul id="discussion">
        </ul>
        
        <div>
            <input id="ready" type="button" value="准备" /></div>
            <table id="gameList" style="width: 100%;">
                <tr>
                    <td>序号</td>
                    <td>姓名</td>
                    <td>状态</td>
                </tr>
               
            </table>
        </div>
   
    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="Scripts/jquery-1.6.4.min.js" ></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.1.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="signalr/hubs"></script>
    <!--Add script to update the page and send messages.--> 
   <script type="text/javascript">
       var userName;

       $(function () {
           // Declare a proxy to reference the hub. 
           var chat = $.connection.chatHub;
           // Create a function that the hub can call to broadcast messages.
           chat.client.broadcastMessage = function (cmd, obj) {
               // Html encode display name and message.      
               listCmd(cmd, obj);
           };      
           // Start the connection.
           $.connection.hub.start().done(function () {
               $('#ready').click(function () {
                   // Call the Send method on the hub.             
                   chat.server.sit(userName);
                   // Clear text box and reset focus for next comment.               
               });

               showAll(chat);

           });

       });

       function listCmd(cmd, obj) {
           if (cmd == "add") {
               gamsUser = JSON.parse(obj);
               // Add the message to the page. 
               $('#gameList').append(' <tr class="rowClass" name="' + gamsUser.UserID + '">' +
                   '<td>' + gamsUser.UserID + '</td>' +
                   '<td>' + gamsUser.UserName + '</td>' +
                   '<td>' + gamsUser.UserStatus + '</td>' +
                 '</li>');

           } else if (cmd == "delete") {
                
           } else if (cmd == "modify") {

               

           } else if (cmd == "show") {

               $('tr.rowClass').remove();

               var GameTabel = JSON.parse(obj);
               for (var i = 0; i < GameTabel.GameList.length; i++) {
                   var gamsUser = GameTabel.GameList[i];
                   $('#gameList').append(' <tr class="rowClass" name="' + gamsUser.UserID + '">' +
                  '<td>' + gamsUser.UserID + '</td>' +
                  '<td>' + gamsUser.UserName + '</td>' +
                  '<td>' + gamsUser.UserStatus + '</td>' +
                '</li>');
               }
              

           } else if (cmd == "msg") {
               
               if (userName==obj) {
                   alert("您已经在游戏中了");
               } else {
               }
           } else if (cmd == "init") {
               $('tr.rowClass').remove();             
           } else {
               chat.server.showAll();
           }
       }

       function init() {         
           userName = prompt('Enter your name:', '');
       }
      
       function showAll(chat) {
           chat.server.show();
       }

    </script>
</body>
</html>